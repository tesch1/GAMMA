###############################################################################
#                                                                             #
#                                 G A M M A                                   #
#               Makefile For The GAMMA MR Simulation Platform                 #
#                      Copyright © 1999 Scott A. Smith                        #
#                  National High Magnetic Field Laboratory                    #
#                         1800 E. Paul Dirac Drive                            #
#                     Tallahassee, FL, USA 32307-4005                         #
#                          ssmith@magnet.fsu.edu                              #
#                      On WWW See gamma.magnet.fsu.edu                        #
#                                                                             #
# The concern of this Makefile is GAMMA source code distribution. Herein are  #
# are defined the targets that are used for such purposes.  They are intended #
# to produce files which can be used to re-compile the plaftorm, but they     #
# will NOT DEAL WITH ANY ADDON FILES. Note that this file is included in the  #
# MAIN GAMMA makefile and should not be confused with a similar file included #
# in makefiles associated to specific GAMMA modules. They are very different! #
#                                                                             #
# Users are free to copy this file for personal use but may NOT give out      #
# modifications with or without the GAMMA platform.  This and other makefiles #
# are typically packaged with the full GAMMA source distribution.  The full   #
# src distrubution may be obtained from the GAMMA WWW site above or any of    #
# its mirrors.                                                                #
#                                                                             #
# Notes: We Still Need GNU Make For This To Work.                             #
#                                                                             #
###############################################################################
               
NPD = --no-print-directory
GZIPPGM  = gzip
GZIPFLGS =
#ZIPPGM   = pkzip
#ZIPFLGS  = -recurse

# Unix "zip" program: zip -q -r this foo make this.zip from directory foo quietly
#                     Here -q is quite mode and -r is recursive mode.  If the 
#                     name "this" has a .zip on the end it will not add zip.

ZIPPGM   = zip
ZIPFLGS  = -q -r

###############################################################################
#                                                                             #
# Primary Targets:                                                            #
#                                                                             #
#    srcdist   : Creates a distribution file of GAMMA sources (ala unix).     #
#                A similar srcdist is run recursively in GAMMA makefiles.     #
#    srcddist  : Creates a distribution file of GAMMA sources (ala windows).  #
#                A similar srcddist is run recursively in GAMMA makefiles.    #
#    hdrdist   : Creates a distribution file of GAMMA headers (ala unix).     #
#                A similar hdrdist is run recursively in GAMMA makefiles.     #
#    hdrddist  : Creates a distribution file of GAMMA headers (ala windows).  #
#                A similar hdrddist is run recursively in GAMMA makefiles.    #
#    srcvars   : Outputs a list of variables used by make during source       #
#                code distributions.                                          #
#                                                                             #
# Secondary Targets (Should NOT Be Run Directly):                             #
#                                                                             #
#    srcdir    : Creates a directory to copy GAMMA sources for distribution.  #
#    stdcopy   : Copies standard files to distribution directory.             #
#    srctar    : Tars up files in the distribution directory into one.        #
#    srcgzip   : Compresses the tar file generated in distribution process.   #
#    srcclean  : Removes file copies placed in the distribution directory.    #
#                                                                             #
###############################################################################

###############################################################################
#                                                                             #
#                             Makefile Variables                              #
#                                                                             #
# Bear in mind that this Makefile is simply included in the main GAMMA        #
# makefile, $GAMMA/Makefile. As such, it will "inherit" all the variables     #
# specified therein. So, THERE ARE NO VARIABLES DECLARED IN THIS FILE. There  #
# are of course variables that are used by the targets in this makefile and   #
# it is these which are listed below.                                         #
#                                                                             #
# GVERSION   : Current GAMMA version, in MakeGam, Makefile included (4.0.7)  #
# MAKE       : The makefile being worked with. Set when invoking Make         #
# SUBDIRS    : Subdirectories with recursive Makefiles for the distribution   #
#              This will be declared in the main GAMMA makefile.              #
# PASSFLAGS  : The flags that will be passed to the recursed makefiles. This  #  
#              variable will be specified in the main GAMMA makefile.         #
# PROJECTPATH: Directory where the tar command is issued from. Hopefully      #
#              this is also where the mock directory $GAMMA/src/ resides      #
#              containing copied source distribution files. This variable will#
#              be defined in the main GAMMA Makefile.                         #
# GAMDIST    : Name of source distribution mock directory. This will be used  #
#              as the based directory where copied files are sent. This       #  
#              variable will be defined in  the Makefile MakeGam              #  
# SRCDIST    : Name of source distribution mock source directory. This is     #
#              the location where GAMMA source directory files are copied.    #
#              This variable will be defined in the Makefile MakeGam          #  
# MAKEDIST   : Name of source distribution mock make directory. This will be  #
#              the location where GAMMA source related make files are copied  #
#              to. The variable will be defined in the Makefile MakeGam       #
# SRCDIRF    : Files in the GAMMA source directory, not in a GAMMA module     #
#              directory, that will be included in the source distribution.   #
# SMAKEDIRF  : Files in the GAMMA make directory, not in a GAMMA source       #
#              module directory, that will be included in the source distrib. #
# SRCDIR     : Name of the source directory (e.g. src)                        #
# MAKEDIR    : Name of the makefile direcotry (e.g. make)                     #
# MAINFILES  : Name of the files, not in the module source directory, but     #
#              they which reside in the main GAMMA directory, that should be  #
#              include in the source distribution.                            #
# SRCDIRFF   : Files in the GAMMA source directory, not in a GAMMA module     #
#              module directory, that will be included in the source distrib. #  
#              These are relative from the main GAMMA directory.              #  
# SMAKEDIRFF : Files in the GAMMA make directory, not in a GAMMA source       #
#              directory, that will be included in the source distribution.   #
#              These are relative from the main GAMMA directory.              #  
# SRCTAR     : Name of the source distribution tar file to be created.        #  
#              This is defined Makefile MakeGam as include in main Makefile.  #
# SRCGZIP     : Name of the source distribution zip file to be created.       #
#              This will be defined in the Makefile MakeGam                   #  
#                                                                             #
###############################################################################

###############################################################################
#                                                                             #
#                             Target: srcdist  hdrdist                        #
#                                     srcddist hdrddist                       #
#                                                                             #
# These targets will copy ALL GAMMA released source/header files from this    #
# directory and all module directories into a temp directory.  It will then   #
# compress those files into a package for distribution.  After the compressed #
# package has been produced all copied (temporary) files will be deleted. The #
# packaging may be performed in two ways. 1) In unix fashion all files will   #
# be placed into a tar file then the tar file compressed using gnu zip (gzip) #
# 2) In windows fashion, all files will be directly compressed into a single  #
# zip file using pkzip.                                                       #
#                                                                             #
# GVERSION: The current GAMMA version                                         #
# MAKE:     The makefile being worked with                                    #
# SUBDIRS:  The subdirectories with recursive Makefiles for the distribution. #
# PASSFLAGS:The flags that will be passed to the recursed makefiles.          #
#                                                                             #
###############################################################################

srcdist:
	@echo
	@echo "Making A Source Distribution, GAMMA Version $(GVERSION)"
	@echo
	@${MAKE} $(NPD) srcdir
	@echo
	@for i in $(SUBDIRS); do \
          if [ -d ./src/$$i ] ; then \
            if (rootme=`pwd`/ ; export rootme ; \
              rootsrc=`cd $(srcdir); pwd`/ ; export rootsrc ; \
              cd ./src/$$i; \
              $(MAKE) $(NPD) $(PASSFLGS) $@) ; then true ; \
            else exit 1 ; fi ; \
          else true ; fi ; \
        done
	@${MAKE} $(NPD) stdsrcnodos
	@${MAKE} $(NPD) stdsrccopy
	@${MAKE} $(NPD) stdfigcopy
	@${MAKE} $(NPD) srctar
	@${MAKE} $(NPD) srcgzip
	@${MAKE} $(NPD) srcclean

srcddist:
	@echo
	@echo "Making A Source Distribution, GAMMA Version $(GVERSION)"
	@echo
	@${MAKE} $(NPD) srcdir
	@echo
	@for i in $(SUBDIRS); do \
           if [ -d ./src/$$i ] ; then \
             if (rootme=`pwd`/ ; export rootme ; \
               rootsrc=`cd $(srcdir); pwd`/ ; export rootsrc ; \
               cd ./src/$$i; \
               $(MAKE) $(NPD) $(PASSFLGS) $@) ; then true ; \
             else exit 1 ; fi ; \
           else true ; fi ; \
        done
	@${MAKE} $(NPD) stdsrcnodos
	@${MAKE} $(NPD) stdsrccopy
	@${MAKE} $(NPD) stdfigcopy
	@${MAKE} $(NPD) srczip
 
hdrdist:
	@echo "Making A Header Distribution, GAMMA Version $(GVERSION)"
	@echo
	@${MAKE} $(NPD) srcdir
	@echo
	@for i in $(SUBDIRS); do \
           if [ -d ./src/$$i ] ; then \
             if (rootme=`pwd`/ ; export rootme ; \
               rootsrc=`cd $(srcdir); pwd`/ ; export rootsrc ; \
               cd ./src/$$i; \
               $(MAKE) $(NPD) $(PASSFLGS) $@) ; then true ; \
             else exit 1 ; fi ; \
           else true ; fi ; \
        done
	@${MAKE} $(NPD) hdrtar
	@${MAKE} $(NPD) hdrgzip
#	@${MAKE} $(NPD) stdsrccopy
#	@${MAKE} $(NPD) stdfigopy
# sosi not yet sure which added files are needed for header distribution
 
hdrddist:
	@echo "Making A Header Distribution, GAMMA Version $(GVERSION)"
	@echo
	@${MAKE} $(NPD) srcdir
	@echo
	@for i in $(SUBDIRS); do \
           echo "  ** Making $@ in ./src/$${i} ..." ; \
           if [ -d ./src/$$i ] ; then \
             if (rootme=`pwd`/ ; export rootme ; \
               rootsrc=`cd $(srcdir); pwd`/ ; export rootsrc ; \
               cd ./src/$$i; \
               $(MAKE) $(NPD) $(PASSFLGS) $@) ; then true ; \
             else exit 1 ; fi ; \
           else true ; fi ; \
        done
	@${MAKE} $(NPD) hdrzip

#	@${MAKE} $(NPD) stdsrccopy
#	@${MAKE} $(NPD) stdfigcopy
# sosi not yet sure which added files are needed for header distribution

srcclear:
	@echo
	@echo "Clearing Old & Backup Source Files, GAMMA Version $(GVERSION)"
	@echo
	@for i in $(SUBDIRS); do \
          if [ -d ./src/$$i ] ; then \
            if (rootme=`pwd`/ ; export rootme ; \
              rootsrc=`cd $(srcdir); pwd`/ ; export rootsrc ; \
              cd ./src/$$i; \
              $(MAKE) $(NPD) $(PASSFLGS) $@) ; then true ; \
            else exit 1 ; fi ; \
          else true ; fi ; \
        done

 
###############################################################################
#                               Target: srcdir                                #
#                           DO NOT RUN THIS TARGET                            #
#                                                                             #
# This target is part of the GAMMA source distribution target & is NOT really #
# meant to run solo. It constructs a "mock" GAMMA directory off of the        #
# current directory. In doing so it allows this makefile to generate a tar    #
# distribution file that, when untarred in the GAMMA root directory, will     #
# generate all the released files having standard GAMMA directory structure.  #
#                                                                             #
# PROJECTPATH - Directory where the tar command is issued from. Hopefully     #  
#               this is also where the mock directory $GAMMA/src/ resides     #
#               containing copied source distribution files. The variable is  #
#               defined in the main GAMMA Makefile.                           #  
# GAMDIST     - Name of source distribution mock directory. This will be used #
#               as the based directory where copied files are sent. This      #  
#               variable will be defined in  the Makefile MakeGam             #  
# SRCDIST     - Name of source distribution mock source directory. This is    #
#               the location where GAMMA source directory files are copied.   #
#               This variable will be defined in the Makefile MakeGam         #  
# MAKEDIST    - Name of source distribution mock make directory. This will be #
#               the location where GAMMA source related make files are copied #
#               to. The variable will be defined in the Makefile MakeGam      #
#                                                                             #
###############################################################################

srcdir:
	@echo ""
	@echo "     Making GAMMA Source Code Distrubution Directory"
	@echo "     -----------------------------------------------"
	@echo ""
	@echo " * Current GAMMA Directory Is $(PROJECTPATH)"
	@echo ""
	@echo " * Copy GAMMA Sources To Temporary Directory ./$(GAMDIST)"
	@if (test -d ./$(GAMDIST)) \
	then \
          echo; \
          echo " * Temp Directory Exists. First Clearing It" ; \
          echo "   Removing Directory ./$(GAMDIST)" ; \
          rm -rf ./$(GAMDIST); \
	fi
	@echo ""
	@echo " * Must First Construct This New Temporary Directory"
	@echo "   Making Directory ./$(GAMDIST)"
	@mkdir $(GAMDIST)
	@chmod ug+w $(GAMDIST)
	@echo " * Next Construct This Src Temporary Directory"
	@echo "   Making Directory ./$(SRCDIST)"
	@mkdir $(SRCDIST)
	@chmod ug+w $(SRCDIST)
	@echo " * Next Construct GAMMA Temporary Makefile Directory"
	@echo "   Making Directory ./$(MAKEDIST)"
	@mkdir $(MAKEDIST)
	@chmod ug+w $(MAKEDIST)
	@echo " * Next Construct GAMMA Temporary Documentation Directory"
	@echo "   Making Directory ./$(DOCDIST)"
	@mkdir $(DOCDIST)
	@chmod ug+w $(DOCDIST)
	@echo " * Next Construct GAMMA Temporary Figures Directory"
	@echo "   Making Directory ./$(FIGDIST)"
	@mkdir $(FIGDIST)
	@chmod ug+w $(FIGDIST)


###############################################################################
#                                                                             #
#                            Target: stdsrcnodos                              #
#                           DO NOT RUN THIS TARGET                            #
#                                                                             #
# This target is part of the GAMMA source distribution target & NOT meant to  #
# run solo. It just takes all of the local standard files associated with the #
# GAMMA sources and removes any DOS characters from them. Note that the files #
# defined here should be those NOT handled by any of the module Makefiles     #
#                                                                             #
# SRCDIRF    : Files in the GAMMA source directory, not in a GAMMA module     #
#              directory, that will be included in the source distribution.   #
# SRCDIRFF   : Files in the GAMMA source directory, not in a GAMMA module     #
#              module directory, that will be included in the source distrib. #  
#                                                                             #
###############################################################################

DOLSIGN = $$
SEDSUB1 = "s/^M\\{1,\\}$(DOLSIGN)//"
SEDSUB2 = "$(DOLSIGN) s/^Z//"

stdsrcnodos:
	@echo
	@echo " * Cleaning All Standard Files By Removing DOS Linefeeds"
	@echo "   Cleaning Standard Source Files In: $(SRCDIR)"
	@for i in $(SRCDIRF); do \
	  echo  "     File: ./src/$$i"; \
	  cat ./src/$$i | sed $(SEDSUB1) | sed $(SEDSUB2) > ./src/$$i.tmp; \
	  mv -f ./src/$$i.tmp ./src/$$i; \
	done
	@echo "   Cleaning Standard Makefiles In: $(MAKEDIR)"
	@for i in $(SMAKEDIRF); do \
	  echo  "     File: ./make/$$i"; \
	  cat ./make/$$i | sed $(SEDSUB1) | sed $(SEDSUB2) > ./make/$$i.tmp; \
	  mv -f ./make/$$i.tmp ./make/$$i; \
	done
	@echo "   Cleaning Standard Files In: ."
	@for i in $(MAINFILES); do \
	  echo  "     File: ./$$i"; \
	  cat ./$$i | sed $(SEDSUB1) | sed $(SEDSUB2) > ./$$i.tmp; \
	  mv -f ./$$i.tmp ./$$i; \
	done


###############################################################################
#                                                                             #
#                              Target: stdsrccopy                             #
#                           DO NOT RUN THIS TARGET                            #
#                                                                             #
# This target is part of the GAMMA source distribution target & NOT meant to  #
# run solo. It just takes all of the local standard files associated with the #
# GAMMA sources and copies them into the temporary source directory. Note     #
# that the files defined here should be those NOT handled by module Makefiles #
#                                                                             #
# SRCDIRF    : Files in the GAMMA source directory, not in a GAMMA module     #
#              directory, that will be included in the source distribution.   #
# SRCDIRFF   : Files in the GAMMA source directory, not in a GAMMA module     #
#              module directory, that will be included in the source distrib. #  
#              These are relative from the main GAMMA directory.              #  
# SRCDIST    : Name of source distribution mock source directory. This is     #
#              the location where GAMMA source directory files are copied.    #
#              This variable will be defined in the Makefile MakeGam          #  
# SMAKEDIRF  : Files in the GAMMA make directory, not in a GAMMA source       #
#              module directory, that will be included in the source distrib. #
# SMAKEDIRFF : Files in the GAMMA make directory, not in a GAMMA source       #
#              directory, that will be included in the source distribution.   #
#              These are relative from the main GAMMA directory.              #  
# MAINFILES  : Name of the files, not in the module source directory, but     #
#              they which reside in the main GAMMA directory, that should be  #
#              include in the source distribution.                            #
# GAMDIST    : Name of source distribution mock directory. This will be used  #
#              as the based directory where copied files are sent. This       #  
#              variable will be defined in  the Makefile MakeGam              #  
#                                                                             #
###############################################################################
 
stdsrccopy:
	@echo
	@echo " * Copying All Standard Files For Source Distribution"
	@echo " * Copying Specific Files From The GAMMA Source Directory"
	@echo "   From: $(SRCDIR)"
	@echo "   To:   $(SRCDIST)"
	@for i in $(SRCDIRF); do \
	  echo  "   File: $$i"; \
	done
	@cp $(SRCDIRFF) $(SRCDIST)
	@echo " * Copying Files From The GAMMA Makefile Directory"
	@echo "   From: $(MAKEDIR)"
	@echo "   To:   $(MAKEDIST)"
	@for i in $(SMAKEDIRF); do \
	  echo  "   File: $$i"; \
	done
	@cp $(SMAKEDIRFF) $(MAKEDIST)
	@echo
	@echo " * Copying Files From The Main GAMMA Directory"
	@echo "   From: ."
	@echo "   To:   $(GAMDIST)"
	@for i in $(MAINFILES); do \
	  echo  "   File: $$i"; \
	done
	@cp $(MAINFILES) $(GAMDIST)
	@chmod a+x $(GAMDIST)/configure

stdfigcopy:
	@echo
	@echo " * Copying All Standard Figure Files For Source Distribution"
	@echo " * Copying Specific Files From The GAMMA Figures Directory"
	@echo "   From: $(FIGDIR)"
	@echo "   To:   $(FIGDIST)"
	@for i in $(FIGDIRF); do \
	  echo  "   File: $$i"; \
	done
	@cp $(FIGDIRFF) $(FIGDIST)

###############################################################################
#                                                                             #
#                                 Target: srctar                              #
#                           DO NOT RUN THIS TARGET                            #
#                                                                             #
# This target is part of the GAMMA source distribution target and not meant   #
# to run solo. It takes all of the files to be released and tars them into a  #
# single file.  All released files are hopefully in a mock test directory     #
# from here that appears appropriately as $GAMMA/src/... directory but using  #
# $GAMMA as this current directory rather than the true GAMMA home directory. #
#                                                                             #
# SRCTAR      - Name of the source distribution tar file to be created.       #  
#               This is defined Makefile MakeGam as include in main Makefile. #
# HDRTAR      - Name of the header distribution tar file to be created.       #  
#               This is defined Makefile MakeGam as include in main Makefile. #
# PROJECTPATH - Directory where the tar command is issued from. Hopefully     #  
#               this is also where the mock directory $GAMMA/src/ resides     #
#               containing copied src distribution files. This variable will  #
#               be defined in the main GAMMA Makefile.                        #  
# GAMDIST     - Name of source distribution mock directory. This will be used #
#               as the based directory where copied files are sent. This      #  
#               variable will be defined in  the Makefile MakeGam             #  
#                                                                             #
###############################################################################

srctar:
	@echo
	@echo " * Generating Tar File Of GAMMA Source Distribution"
	@echo "   Making New TarFile From $(PROJECTPATH)"
	@echo "   New Tar File Will Be Called $(SRCTAR)"
	@if (test -f $(SRCTAR)) \
	then \
	  echo "   First Deleting Existing Tar File $(SRCTAR)"; \
	  rm -f $(SRCTAR); \
	fi
	@echo "   Tar Done Using Relative Directory ./$(GAMDIST)"
	@tar cf $(SRCTAR) ./$(GAMDIST)
	@echo "   New Tar File $(SRCTAR) Complete"

hdrtar:
	@echo
	@echo " * Generating Tar File Of GAMMA Header Distribution"
	@echo "   Making New TarFile From $(PROJECTPATH)"
	@echo "   New Tar File Will Be Called $(HDRTAR)"
	@if (test -f $(HDRTAR)) \
	then \
	  echo "   First Deleting Existing Tar File $(HDRTAR)"; \
	  rm -f $(HDRTAR); \
	fi
	@echo "   Tar Done Using Relative Directory ./$(GAMDIST)"
	@tar cf $(HDRTAR) ./$(GAMDIST)
	@echo "   New Tar File $(HDRTAR) Complete"
 
 
###############################################################################
#                                                                             #
#                           Target: srcgzip, hdrgzip                          #
#                                                                             #
#                           DO NOT RUN THIS TARGET                            #
#                                                                             #
# This target is part of the source distribution target and not meant to run  #
# solo. It takes the single tar file in this directory (generated from        #
# previous targets) and compresses them using GNU zip.  The result will be a  #
# single source distribution file.                                            #
#                                                                             #
# SRCTAR      - Name of the source distribution tar file to be created.       #  
#               This is defined Makefile MakeGam as include in main Makefile. #
# GZIPPGM     - Name of program that will compress tar files (tar->tar.gz)    #
# GZIPFLGS    - Flags for the compression program GZIPPGM (usually none)      #
# SRCGZIP     - Name of the source distribution zip file to be created.       #
#               This file will be a compression of the source tar file.       #
#               This variable will be defined in the Makefile MakeGam         #
# HDRTAR      - Name of the header distribution tar file to be created.       #  
#               This is defined Makefile MakeGam as include in main Makefile. #
# HDRGZIP     - Name of the header distribution zip file to be created.       #
#               This file will be a compression of the header tar file.       #
#               This variable will be defined in the Makefile MakeGam         #
# ZIPPGM      - Program that compresses distribution directory (pkzip or zip) #
# ZIPFLGS     - Flags for the compression program ZIPPGM (usually -p -r)      #
# PROJECTPATH - Directory where the tar command is issued from. Hopefully     #
#               this is also where the mock directory $GAMMA/src/ resides     #
#               containing copied src distribution files. This variable will  #
#               be defined in the main GAMMA Makefile.                        #
# GAMDIST     - Name of source distribution mock directory. This will be used #
#               as the based directory where copied files are sent. This      #
#               variable will be defined in  the Makefile MakeGam             #
#                                                                             #
###############################################################################

srcgzip: 
	@echo
	@echo " * Generating Zipped File Of GAMMA Source Distribution"; 
	@echo "   The Tar File $(SRCTAR) Will Be Compressed Using $(GZIPPGM)";
	@if (test -f $(SRCGZIP)) \
        then \
          echo "   First Deleting Existing Zip File $(SRCGZIP)"; \
          rm -f $(SRCGZIP); \
        fi
	@echo "   Making New Zip File From $(SRCTAR)"
	@$(GZIPPGM) $(GZIPFLGS) $(SRCTAR)
	@echo "   New Zip File Completed, Named $(SRCGZIP) In Current Directory"
	@echo "   The Current Directory Is $(PROJECTPATH)"

hdrgzip: 
	@echo
	@echo " * Generating Zipped File Of GAMMA Header Distribution"; 
	@echo "   The Tar File $(HDRTAR) Will Be Compressed Using $(GZIPPGM)";
	@if (test -f $(HDRGZIP)) \
        then \
          echo "   First Deleting Existing Zip File $(HDRGZIP)"; \
          rm -f $(HDRGZIP); \
        fi
	@echo "   Making New Zip File From $(HDRTAR)"
	@$(GZIPPGM) $(HDRTAR)
	@echo "   New Zip File Completed, Named $(HDRGZIP) In Current Directory"
	@echo "   The Current Directory Is $(PROJECTPATH)"

srczip: 
	@echo
	@echo " * Generating Zipped File Of GAMMA Source Distribution"; 
	@echo "   The Entire Directory $(GAMDIST) Will Be Zipped";
	@echo "   Command To Zip Will Be $(ZIPPGM) $(ZIPFLGS) $(SRCZIP) $(GAMDIST)";
	@echo "   The Resulting Zip File Will Be Named $(SRCZIP)";
	@if (test -f $(SRCZIP)) \
        then \
          echo "   First Deleting Existing Zip File $(SRCZIP)"; \
          rm -f $(SRCZIP); \
        fi
	@echo "   Making New Zip File From $(GAMDIST)"
	@$(ZIPPGM) $(ZIPFLGS) $(SRCZIP) $(GAMDIST)
	@echo "   New Zip File Completed, Named $(SRCZIP) In Current Directory"
	@echo "   The Current Directory Is $(PROJECTPATH)"

hdrzip: 
	@echo
	@echo " * Generating Zipped File Of GAMMA Header Distribution"; 
	@echo "   The Directory $(GAMDIST) Will Be Compressed Using $(ZIPPGM)";
	@if (test -f $(HDRZIP)) \
        then \
          echo "   First Deleting Existing Zip File $(HDRZIP)"; \
          rm -f $(HDRZIP); \
        fi
	@echo "   Making New Zip File From $(GAMDIST)"
	@$(ZIPPGM) $(ZIPFLGS) $(HDRZIP) $(GAMDIST)
	@echo "   New Zip File Completed, Named $(HDRZIP) In Current Directory"
	@echo "   The Current Directory Is $(PROJECTPATH)"

 
###############################################################################
#                                Target: srcclean                             #
#                                                                             #
# This removes any temporary directories and files that have been produced in #
# a GAMMA source distribution.                                                #
#                                                                             #
# GAMDIST     - Name of source distribution mock directory. This will be used #
#               as the based directory where copied files are sent. This      #  
#               variable will be defined in  the Makefile MakeGam             #  
#                                                                             #
###############################################################################
 
srcclean:
	@echo ""
	@echo " * Cleaning Up Temporary Source Files And Any Directories"
	@echo "   Removing Files Below ./$(GAMDIST) And ./$(GAMDIST) Directory"
	@rm -rf $(GAMDIST)
	@echo ""

###############################################################################
#                               Target: srcvars                               #
#                                                                             #
# During a GAMMA source distribution files are moved around, directories      #
# created and destroyed. This can be dangerous if some variables in the       #
# Makefile are improperly set. At the vary least, the different targets will  #
# not work. At worst, important files are destroyed.  This target will simply #
# spit out all of the variables that are (overtly) used in the makefile. This #
# way one can have a look if things appear proper prior to running anything   #
# that does file/directory manipulations. This target is not normally run by  #
# a GAMMA user, it is more useful in building makefiles and debugging them.   #  
#                                                                             #
###############################################################################

srcvars:   
	@echo ""
	@echo "   Make Variables Used For GAMMA Source Code Distrubutions"
	@echo "   -------------------------------------------------------"
	@echo ""
	@echo "  GVERSION     The GAMMA Version                 = $(GVERSION)"
	@echo "  GAMDIST      Relative Temp GAMMA Dist. Dir.    = $(GAMDIST)"
	@echo "  SRCDIR       The GAMMA Source Directory Name   = $(SRCDIR)"
	@echo "  SRCDIST      The GAMMA Mock Source Directory   = $(SRCDIST)"
	@echo "  SRCNAME      Source Package Name               = $(SRCNAME)"
	@echo "  SRCTAR       Tarred Source Package Name        = $(SRCTAR)"
	@echo "  SRCZIP       Zipped Source Package Name        = $(SRCZIP)"
	@echo "  MAKEDIR      The GAMMA Makefile Directory Name = $(MAKEDIR)"
	@echo "  MAKEDIST     The GAMMA Mock Makefile Directory = $(MAKEDIST)"
	@echo "  MAKE         The Make Program Being Used       = $(MAKE)"
	@echo "  PROJECTPATH  GAMMA Project Path (Full Direct.) = $(PROJECTPATH)"
	@echo "  SRCDIRF      Files Included From Source Dir.   = $(SRCDIRF)"
	@echo "  SRCDIRFF     Full Files (From Above) Included  = $(SRCDIRFF)"
	@for i in $(SMAKEDIRF); do \
	echo "  SMAKEDIRF    Makefile Included From Make Dir   = $$i"; \
	done
	@for i in $(SMAKEDIRFF); do \
	echo "  SMAKEDIRFF   Full Files (Above Two) Included   = $$i"; \
	done
	@for i in $(MAINFILES); do \
	echo "  MAINFILES    GAMMA Main Direct. Files Included = $$i"; \
	done
	@echo "  PASSFLGS     Variables Sent To Recursive Makes :"
	@echo
	@for i in $(PASSFLGS); do \
	echo "   $$i"; \
	done
	@echo

	@for i in $(SUBDIRS); do \
           if [ -d ./$(SRCDIR)/$$i ] ; then \
             if (rootme=`pwd`/ ; export rootme ; \
               rootsrc=`cd $(srcdir); pwd`/ ; export rootsrc ; \
               cd ./$(SRCDIR)/$$i; \
               $(MAKE) --no-print-directory $(PASSFLGS) $@) ; then true ; \
             else exit 1 ; fi ; \
	   else true ; fi ; \
        done
	@echo ""

###############################################################################
#                               Target: srcmakes                              #
#                                                                             #
# All module source Makefiles, $GAMMA/src/$MODULE/Makefile, are equivalent.   #
# When changes are to be made to them they should be made to only one and     #
# subesequently that should be propagated to all module subdirectories.  Such #
# is the purpose of this target.  When this target is made it will copy the   #
# standard "boilerplate" source Makefile, $GAMMA/make/MakeModSrcBP, to all    #
# module Makefiles, $GAMMA/src/$MODULE/Makefile. This may also useful if any  #
# module Makefiles get messed up from work having been done on a Wintel       #
# based system with automatic file transfer to Unix.  Often each line will be #
# left with a ^M on the end and this can mess up a Makfile. However, that     #
# should not really happen because individual module makefiles should never   #
# be edited, either on a Unix or PC.  It should always be the boilerplate     #
# Makefile that is edited then propagated to all module sub-directories.      #
#                                                                             #
# Note that it is the individual MakeDefs files, $GAMMA/src/$Module/MakeDefs, #
# that cause each module's makefile to be unique. It is these latter files    #
# that may be edited to suit individual modules.                              #
#                                                                             #
# SUBDIRS:      Subdirectories with recursive Makefiles for the distribution  #
#               This will be declared in the main GAMMA makefile.             #
# SRCDIR:       Name of the source directory (e.g. src)                       #
# MAKEDIR:      Name of the makefile direcotry (e.g. make)                    #
# MakeModSrcBP: Name of module boilerplate source Makefile                    #
#                                                                             #
###############################################################################

srcmakes: force  
	@echo
	@echo " * Updating Makefiles In All Module Source Directories"
	@for i in $(SUBDIRS); do \
           if [ -d ./$(SRCDIR)/$$i ] ; then \
             if (rootme=`pwd`/ ; export rootme ; \
               rootsrc=`cd $(srcdir); pwd`/ ; export rootsrc ; \
               echo "    - Updating Makefile In" $$i "Source Module"; \
               cp -f ./$(MAKEDIR)/MakeModSrcBP ./$(SRCDIR)/$$i/Makefile); then true; \
             else exit 1 ; fi ; \
	   else true ; fi ; \
        done
	@echo ""
