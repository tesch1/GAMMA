###############################################################################
#                                                                             #
#                      Makefile For A Test GAMMA Module                       #
#                     Copyright (C) 2000 Scott A. Smith                       #
#                  National High Magnetic Field Laboratory                    #
#                         1800 E. Paul Dirac Drive                            #
#                     Tallahassee, FL, USA 32306-4005                         #
#                          ssmith@magnet.fsu.edu                              #
#                      On WWW See gamma.magnet.fsu.edu                        #
#                                                                             #
# This Makefile is intended to be called recursively from the main GAMMA      #
# makefile, $GAMMA/Makefile.  It's purpose is to handle compilation and       #
# distribution of files in this GAMMA module. This file should reside in      #
# the module directory from the GAMMA test directory, $GAMMA/test. It will    #
# NOT be different from any other GAMMA tset module's Makefile. Module        #
# specifics are imported in, as are common segements shared by all module     #
# Makefiles.                                                                  #
#                                                                             #
#    IT IS UNLIKELY YOU WOULD EVER NEED TO MAKE CHANGES IN THIS FILE!         #
#             SPECIFICS FOR THIS FILE ARE FOUND IN MakeDefs                   #
#                                                                             #
# All module specifics are included in the file MakeDefs.  If any changes are #
# needed for this specific module change ./MakeDefs.  If any changes are      #
# required for targets change the included segments in ../Make* so that they  #
# will apply to all module Makefiles.                                         # 
#                                                                             #
# The primary targets provided by this makefile are:                          #
#                                                                             #
# test     : Test the GAMMA platform.  This will compile an overall test      #
#            program then run it, sending the test results to screen.         #
#            Unlike other GAMMA testing (testsuite) this does not demand use  #
#            of the DejaGnu test framework (expect, tcl, etc..)               #
# testdist : Creates a distribution file of module test programs. A similar   #
#            testdist is run in the main GAMMA makefiles and recurses this.   #
# testvars : Output all variables relevant to using this makefile to screen.  #
#            This is done in a nicely formatted manner and useful in Makefile #
#            debugging. Most GAMMA users will not wish to use this.           #
#                                                                             #
# Users are free to copy this file for personal use but may NOT give out      #
# modifications with or without the GAMMA platform.  This GAMMA module's      #
# source distrubution is typically packaged with the full GAMMA source        #
# distribution.  The full src distrubution and one for just this module may   #
# be obtained from the GAMMA WWW site above or any of its mirrors.            #
#                                                                             #
###############################################################################

###############################################################################
#                                                                             #
#                          Module Specific Definitons                         # 
#                                                                             #
# The following included Makefile controls GAMMA module specifics.  It is in  #
# this file where anything specific to the module in this directory should be #
# specified.  It contents are listed below.                                   #
#                                                                             #
# DIRNAME   - The Local Directory Name                                        #
# DIRNAMEUL - Cosmetic Underline Of Local Directory Name                      #
# FNAMES    - Base Names of Source/Header Files in The Module. Thus All The   #
#             Module Source Code to Be Compiled Are in $(FNAMES).cc And Their #
#             Associated Interface Files $(FNAMES).h.  The Resulting Object   #
#             Files Will Be $(FNAMES).o.                                      #
#                                                                             #
###############################################################################

include ./MakeDefs

###############################################################################
#                                                                             #
#                         Non-Specific Module Definitions                     #
#                                                                             #
# These are generated from the variables defined in ./ModDefs.  The ones used #
# from ./ModDefs are                                                          #
#                                                                             #
# DIRNAME   - The Local Directory Name                                        #
# DIRNAMEUL - Cosmetic Underline Of Local Directory Name                      #
#                                                                             #
# The variables set in this section are as follows:                           #
#                                                                             #
# MODLABEL  - This Modules Label for Output                                   #
# MODLABUN  - This Modules Label Output Underlining                           #
# BASENAME  - Base Name Of Output File(s) To Be Produced                      #
# MODTESTCC - Name of the module test program.                                #
# MODTESTEX - Name of the module test program executable.                     #
# MODTESTM4 - Name of the module test program m4 macro file.                  #
#                                                                             #
###############################################################################

MODLABEL = GAMMA $(DIRNAME)
MODLABUN = ------$(DIRNAMEUL)
BASENAME = $(DIRNAME)Tst
MODTESTCC = Test$(DIRNAME).cc
MODTESTEX = Test$(DIRNAME).exe
MODTESTM4 = Test$(DIRNAME).m4

###############################################################################
#                                                                             #
#                        Generic GAMMA Make Variables                         #
#                                                                             #
# This included Makefile simply contains variable definitions used in many    #
# GAMMA makefiles. Below are listed only those that are of direct consequence #
# to running a module's testing related targets, i.e. those that are used in  #
# this makefile.                                                              #
#                                                                             #
#  TESTDIR:   The GAMMA testing directory name (e.g. test)                    #
#  TESTPGM:   GAMMA test program source name, in MakeGam, Makefile included.  #
#  TESTBIN:   GAMMA test program binary name, in MakeGam, Makefile included.  #
#  GAMMAPGM:  The GAMMA program command, in MakeGam, Makefile included        #
#                                                                             #
###############################################################################

include ../../make/MakeGam

###############################################################################
#                                                                             #
#                             Module Test Targets                             #
#                                                                             #
# This included Makefile contains targets for perforing GAMMA tests on a      #
# specified module. It demands that some variables be set in any Makefile     #
# (such as this one) that includes it.  These are listed below under External #
# Variables. Those that are starred will stem from the main GAMMA Makefile,   #
# if it has been used. Those not starred should have been specified somewhere #
# earlier in this file.	                                                      #
#                                                                             #
# Test Primary Targets:                                                       #
#                                                                             #
# test     : Test the GAMMA platform.  This will compile an overall test      #
#            program then run it, sending the test results to screen.         #
#            Unlike other GAMMA testing (testsuite) this does not demand use  #
#            of the DejaGnu test framework (expect, tcl, etc..)               #
# testdist : Creates a distribution file of GAMMA test programs.  A           #
#            similar testdist is run recursively in GAMMA module makefiles.   #
# testvars : Output all variables relevant to using this makefile to screen.  #
#            This is done in a nicely formatted manner and useful in Makefile #
#            debugging. Most GAMMA users will not wish to use this.           #
#                                                                             #
# External Variables:                                                         #
#                                                                             #
# *NOTSOLO:   Flag if running independently or recursively by Main makefile   #
# *PASSFLGS:  The flags that are passed from the main GAMMA makefile during   #  
#             recursion into this file.                                       # 
# *MODULEDIR: The is the test module directory. If the makefile is running    #
#             SOLO it will simply be the current directory.  If it is run as  #
#             part of a larger test source distribution it will be the full   #
#             path directory name (which will be $GAMMA/test or so)           #
# *COPY2BASE: This will serve as the point just below where the copied test   #  
#             directory will reside. For a SOLO distribution of a single      #
#             module that will be ".", but for a larger test source dist-     #
#             ribtion this will be a full path to a copied GAMMA directory.   #
#  BASENAME:  Base name of distribution file.  Not used unless run SOLO       #
#  FNAMES:    Test source file base names to be included in the module test   #
#             distribution. These names will have a .cc appended to them and  #
#             they should reside in the module directory.                     #
#  SUPPF:     Supplemental files that are to be included in the module test   #
#             distribution. These names will not have any prefix added but    #
#             they should reside in the module directory.                     #
#  TESTDIR:   The GAMMA testing directory name (e.g. test)                    #
#  DIRNAME:   The module directory name (e.g. Basics, Matrix, ...)            #
#  TESTPGM:   GAMMA test program source name, in MakeGam, Makefile included.  #
#  TESTBIN:   GAMMA test program binary name, in MakeGam, Makefile included.  #
#  GAMMAPGM:  The GAMMA program command, in MakeGam, Makefile included        #
#                                                                             #
###############################################################################

include ../../make/MakeModTest

###############################################################################
#                                Target: force                                #
#                                                                             #
# This is never satisfied.  So, it is used in the dependency of other targets #
# when we want to be sure those targets run.                                  #
#                                                                             #
###############################################################################

force:

###############################################################################
#                                                                             #
#                                 Pattern: cc                                 #
#                                                                             #
# %.cc - What to do when a "cc" file is not present.  This pattern will try   #
#        to build any missing cc file from the M4 macro file of the same      #
#        name. If a corresponding m4 file doesn't exist then we just ignore   #
#        it.                                                                  #
#                                                                             #
###############################################################################

%.cc: %.m4
	@echo "   * Building New Source File From $< ..."
	@if (test -f $<) \
	then \
	  rm -f $@;\
	  m4 $< > $@;\
	fi

